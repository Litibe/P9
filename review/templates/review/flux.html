{% extends '_base.html' %} {% load static %}
<!-- Page Home-->

{% block main_content %}
<style>
  body {
    background-image: url("{% static 'review/img/typewriter-801921_1920.jpg' %}");
    background-attachment: fixed;
    background-repeat: no-repeat;
    background-size: cover;
  }
</style>
<div
  class="container col-12 col-md-9 col-lg-6 m-auto p-2 shadow-lg borderTitle"
>
  <div class="column">
    <div class="jumbotron text-center">
      <h1>LITReview - Flux</h1>
    </div>
    <div class="d-flex flex-row justify-content-center">
      <a
        style="text-decoration: none; color: inherit"
        href="{% url 'review:create_new_ticket' %}"
        class="btn btn-warning m-auto"
        >Demander une critique</a
      >
      <a
        style="text-decoration: none; color: inherit"
        href="{% url 'review:create_new_ticket_and_review' %}"
        class="btn btn-warning m-auto"
        >Créer une critique</a
      >
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <div class="m-3 p-5 bg-light borderLeft">
      {% for ticket in tickets %}
      <!--if critique associé au ticket-->
      {% if ticket.review %}
      <div class="border border-success p-4 m-3">
        {% if ticket.review.user_id == request.user.id %}
        <p>Vous avez publié une critique</p>
        {% else %}
        <p>{{ticket.review.user}} a publié une critique</p>
        {% endif%}
        <p class="text-end">Date de demande : {{ticket.review.time_created}}</p>
        <h3 class="text-success">
          {{ ticket.review.headline }} - {% if ticket.review.rating == 0 %}
          {%endif%}{% if ticket.review.rating == 1 %}⭐️{%endif%}
          <!---->
          {% if ticket.review.rating == 2 %}⭐️⭐️{% endif%}
          <!---->
          {% if ticket.review.rating == 3 %}⭐️⭐️⭐️{% endif%}
          <!---->
          {% if ticket.review.rating == 4 %}⭐️⭐️⭐️⭐️{% endif%}<!---->
          {% if ticket.review.rating == 5 %}⭐️⭐️⭐️⭐️⭐️{% endif%}
        </h3>
        <p>{{ticket.review.body}}</p>

        <div class="border border-primary p-4 m-3">
          {% if ticket.user_id == request.user.id %}
          <p>Vous avez demandé une critique</p>
          {% else %}
          <p>{{ticket.user}} a demandé une critique</p>
          {% endif %}
          <a
            href="../ticket/{{ ticket.id }}"
            style="color: inherit; text-decoration: none"
          >
            <h3 class="text-primary">
              Ticket #{{ ticket.id }} : {{ ticket.title }}
            </h3></a
          >
          <p class="text-end">Date de demande : {{ticket.time_created}}</p>

          <div class="border border-primary p-4 m-3">
            {% if ticket.image.url %}
            <img src="{{ ticket.image.url }}" width="100px" />
            {% endif %}
            <p class="text-primary m-3">Description de la demande :</p>
            <p>{{ ticket.description }}</p>
          </div>
        </div>
      </div>
      <hr />
      {% else %}
      <div class="border border-primary p-4 m-3">
        <p>{{ticket.user}} a demandé une critique</p>
        <a
          href="../ticket/{{ ticket.id }}"
          style="color: inherit; text-decoration: none"
        >
          <h3 class="text-primary">
            Ticket #{{ ticket.id }} : {{ ticket.title }}
          </h3></a
        >
        <p class="text-end">Date de demande : {{ticket.time_created}}</p>

        <div class="border border-primary p-4 m-3">
          {% if ticket.image.url %}
          <img src="{{ ticket.image.url }}" width="100px" />
          {% else %}
          <p></p>
          {% endif %}
          <p class="text-primary m-3">Description de la demande :</p>
          <p>{{ ticket.description }}</p>
        </div>
        <div class="text-end">
          <button class="btn btn-warning">
            <a
              href="../create_new_review_for_ticket/{{ticket.id}}"
              style="color: inherit; text-decoration: none"
              >Créer une critique</a
            >
          </button>
        </div>
      </div>
      <hr />
      {% endif %}{% endfor %}
    </div>
  </div>
  {% endblock main_content %}
</div>
